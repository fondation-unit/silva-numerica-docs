"use strict";(self.webpackChunksilva_numerica_docs=self.webpackChunksilva_numerica_docs||[]).push([[6383],{7773:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>s,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>a});var t=n(5893),r=n(1151);const d={sidebar_position:1},c="Authentification OAuth2",l={id:"authentification/authentification-oauth2",title:"Authentification OAuth2",description:"Description des flux d'authentification.",source:"@site/docs/authentification/authentification-oauth2.md",sourceDirName:"authentification",slug:"/authentification/authentification-oauth2",permalink:"/silva-numerica-docs/docs/authentification/authentification-oauth2",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Authentification",permalink:"/silva-numerica-docs/docs/category/authentification"},next:{title:"Authentification Device Flow",permalink:"/silva-numerica-docs/docs/authentification/authentification-device-flow"}},s={},a=[{value:"Device Authentication Flow",id:"device-authentication-flow",level:2},{value:"Fonctionnement",id:"fonctionnement",level:3},{value:"Sch\xe9ma",id:"sch\xe9ma",level:3},{value:"Utilisation",id:"utilisation",level:3},{value:"1. Requ\xeate d&#39;autorisation de client",id:"1-requ\xeate-dautorisation-de-client",level:4},{value:"2. Autorisation de client",id:"2-autorisation-de-client",level:4},{value:"3. Polling de l&#39;URI de token",id:"3-polling-de-luri-de-token",level:4},{value:"R\xe9ponses du serveur :",id:"r\xe9ponses-du-serveur-",level:5},{value:"4. Affichage interface de confirmation",id:"4-affichage-interface-de-confirmation",level:4},{value:"5. Confirmation du code par l&#39;utilisateur",id:"5-confirmation-du-code-par-lutilisateur",level:4},{value:"6. Token d&#39;acc\xe8s",id:"6-token-dacc\xe8s",level:4},{value:"7. Rafra\xeechir un token d&#39;acc\xe8s (optionnel)",id:"7-rafra\xeechir-un-token-dacc\xe8s-optionnel",level:4},{value:"Acc\xe8s \xe0 l&#39;API",id:"acc\xe8s-\xe0-lapi",level:2},{value:"Acc\xe8s aux informations utilisateur :",id:"acc\xe8s-aux-informations-utilisateur-",level:3}];function o(e){const i={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h1,{id:"authentification-oauth2",children:"Authentification OAuth2"}),"\n",(0,t.jsx)(i.p,{children:"Description des flux d'authentification."}),"\n",(0,t.jsx)(i.h2,{id:"device-authentication-flow",children:"Device Authentication Flow"}),"\n",(0,t.jsx)(i.p,{children:"Permet \xe0 un utilisateur d\u2019authentifier un client sans que celui-ci n\u2019ait besoin d\u2019une URL de callback (pas de n\xe9cessit\xe9 de serveur web)."}),"\n",(0,t.jsx)(i.p,{children:"Le client doit \xeatre en capacit\xe9 :"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"d\u2019ouvrir un navigateur embarqu\xe9 ou d\u2019ouvrir le navigateur sur le terminal de l\u2019utilisateur"}),"\n",(0,t.jsx)(i.li,{children:"de r\xe9aliser un polling HTTP sur un endpoint durant la phase de validation par l\u2019utilisateur"}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"fonctionnement",children:"Fonctionnement"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"1."})," Le client interroge une URL charg\xe9e de contr\xf4ler le client ID et de retourner des param\xe8tres pour le contr\xf4le du device."]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["URL : ",(0,t.jsx)(i.code,{children:"[API_URL]/oauth/authorize_device"})]}),"\n",(0,t.jsxs)(i.li,{children:["Param\xe8tre n\xe9cessaire : ",(0,t.jsx)(i.code,{children:"client_id"})]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"2."})," Le serveur d\u2019authentification retourne les infos suivantes : ",(0,t.jsx)(i.code,{children:"device_code"}),", ",(0,t.jsx)(i.code,{children:"user_code"}),", ",(0,t.jsx)(i.code,{children:"verification_uri"}),", ",(0,t.jsx)(i.code,{children:"expires_in"}),", ",(0,t.jsx)(i.code,{children:"interval"})]}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"3."})," Le client effectue en parall\xe8le :"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["un polling \xe0 intervalle indiqu\xe9e par le retour de requ\xeate (attribut ",(0,t.jsx)(i.code,{children:"interval"}),") sur l\u2019URL de token (",(0,t.jsx)(i.code,{children:"[API_URL]/oauth/token"}),")"]}),"\n",(0,t.jsxs)(i.li,{children:["un affichage de page de navigateur correspondant \xe0 l\u2019URL ",(0,t.jsx)(i.code,{children:"verification_uri"})]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"4."})," Le serveur d\u2019authentification retourne le token d\u2019acc\xe8s sur le token endpoint (",(0,t.jsx)(i.code,{children:"[API_URL]/oauth/token"}),") lorsque l\u2019utilisateur confirme le code embarqu\xe9 dans l\u2019URL ",(0,t.jsx)(i.code,{children:"verification_uri"})," depuis la page de navigateur"]}),"\n",(0,t.jsx)(i.h3,{id:"sch\xe9ma",children:"Sch\xe9ma"}),"\n",(0,t.jsx)(i.p,{children:"Sch\xe9ma de s\xe9quence du device flow :"}),"\n",(0,t.jsx)(i.mermaid,{value:"  sequenceDiagram\n    participant Client 1\n    participant Service authentification\n    Client 1->>Service authentification: 1. Requ\xeate d'autorisation de client\n    Service authentification->>Client 1: 2. Autorisation de client\n    loop Toutes les 5 secondes\n      Client 1->>Service authentification: 3. Polling de l'URI de token\n    end\n    Client 1->>Client 1: 4. Affichage interface de confirmation\n    Client 1->>Service authentification: 5. Confirmation du code par l'utilisateur\n    Service authentification->>Client 1: 6. Token d'acc\xe8s"}),"\n",(0,t.jsx)(i.h3,{id:"utilisation",children:"Utilisation"}),"\n",(0,t.jsx)(i.h4,{id:"1-requ\xeate-dautorisation-de-client",children:"1. Requ\xeate d'autorisation de client"}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Requ\xeate"}),(0,t.jsx)(i.th,{children:"URL"}),(0,t.jsx)(i.th,{children:"Param\xe8tres"})]})}),(0,t.jsx)(i.tbody,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"POST"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"[API_URL]/oauth/authorize_device"})}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"client_id"})})]})})]}),"\n",(0,t.jsx)(i.h4,{id:"2-autorisation-de-client",children:"2. Autorisation de client"}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Attribut"}),(0,t.jsx)(i.th,{children:"Type"}),(0,t.jsx)(i.th,{children:"Description"})]})}),(0,t.jsxs)(i.tbody,{children:[(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"device_code"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Str"})}),(0,t.jsx)(i.td,{children:"Code d'authentification du client n\xe9cessaire pour la requ\xeate 3."})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"user_code"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Str"})}),(0,t.jsx)(i.td,{children:"Code que l'utilisateur doit valider pour s'authentifier"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"verification_uri"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Str"})}),(0,t.jsx)(i.td,{children:"URL de l'interface de validation de l'authentification (sans le code)"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"verification_uri_complete"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Str"})}),(0,t.jsx)(i.td,{children:"URL de l'interface de validation de l'authentification (avec le code en param\xe8tre)"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"expires_in"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Int"})}),(0,t.jsx)(i.td,{children:"Dur\xe9e de validit\xe9 de la requ\xeate d'autorisation"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"interval"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Int"})}),(0,t.jsx)(i.td,{children:"Intervale autoris\xe9e pour effectuer le polling"})]})]})]}),"\n",(0,t.jsx)(i.h4,{id:"3-polling-de-luri-de-token",children:"3. Polling de l'URI de token"}),"\n",(0,t.jsxs)(i.p,{children:["Effectu\xe9 sur une intervale correspondant \xe0 la valeur ",(0,t.jsx)(i.code,{children:"interval"})," de la requ\xeate ",(0,t.jsx)(i.em,{children:(0,t.jsx)(i.strong,{children:"2. Autorisation de client"})}),"."]}),"\n",(0,t.jsxs)(i.p,{children:["Expire au bout de ",(0,t.jsx)(i.code,{children:"expires_in"})," secondes."]}),"\n",(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Requ\xeate"}),(0,t.jsx)("th",{children:"URL"}),(0,t.jsx)("th",{children:"Param\xe8tre"}),(0,t.jsx)("th",{children:"Valeur"})]})}),(0,t.jsxs)("tbody",{children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{rowspan:"3",children:"POST"}),(0,t.jsx)("td",{rowspan:"3",children:(0,t.jsx)(i.code,{children:"[API_URL]/oauth/token"})}),(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"grant_type"})}),(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"urn:ietf:params:oauth:grant-type:device_code"})})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"device_code"})}),(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"[REDACTED]"})})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"client_id"})}),(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"[REDACTED]"})})]})]})]}),"\n",(0,t.jsx)(i.h5,{id:"r\xe9ponses-du-serveur-",children:"R\xe9ponses du serveur :"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Polling en attente de la confirmation :"}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-js",children:'{\xa0"error": "authorization_pending" }\n'})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Polling trop fr\xe9quent vis \xe0 vis de l'intervale :"}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-js",children:'{\xa0"error": "slow_down" }\n'})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Polling apr\xe8s authentification avec succ\xe8s :"}),"\n"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-js",children:'{\n  "access_token": "[REDACTED]",\n  "token_type": "Bearer",\n  "expires_in": 7200,\n  "refresh_token": "[REDACTED]",\n  "scope": "read",\n  "created_at": 1707128830\n}\n'})}),"\n",(0,t.jsx)(i.h4,{id:"4-affichage-interface-de-confirmation",children:"4. Affichage interface de confirmation"}),"\n",(0,t.jsxs)(i.p,{children:["Ouverture de l'interface web correspondant \xe0 l'URL ",(0,t.jsx)(i.code,{children:"verification_uri_complete"})," (avec le ",(0,t.jsx)(i.code,{children:"user_code"})," pr\xe9-rempli) ou ",(0,t.jsx)(i.code,{children:"verification_uri"})," (sans code pr\xe9-rempli - n\xe9cessaire de le fournir \xe0 l'utilisateur pour r\xe9aliser l'authentification)."]}),"\n",(0,t.jsx)(i.h4,{id:"5-confirmation-du-code-par-lutilisateur",children:"5. Confirmation du code par l'utilisateur"}),"\n",(0,t.jsx)(i.p,{children:"Action men\xe9e par l'utilisateur dans l'interface web (clic sur le bouton de validation)."}),"\n",(0,t.jsx)(i.h4,{id:"6-token-dacc\xe8s",children:"6. Token d'acc\xe8s"}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Attribut"}),(0,t.jsx)(i.th,{children:"Type"}),(0,t.jsx)(i.th,{children:"Description"})]})}),(0,t.jsxs)(i.tbody,{children:[(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"access_token"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Str"})}),(0,t.jsx)(i.td,{children:"Token d'acc\xe8s utilisable pour r\xe9cup\xe9rer les informations de l'utilisateur via l'API"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"token_type"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Str"})}),(0,t.jsx)(i.td,{children:"Bearer"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"expires_in"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Str"})}),(0,t.jsx)(i.td,{children:"Dur\xe9e de validit\xe9 du token (7200 secondes)"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"refresh_token"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Str"})}),(0,t.jsx)(i.td,{children:"Refrensh token utilisable pour bypasser le device flow"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"scope"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Int"})}),(0,t.jsx)(i.td,{children:"Champ d'application"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"created_at"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"Int"})}),(0,t.jsx)(i.td,{children:"Date timestamp de cr\xe9ation du token"})]})]})]}),"\n",(0,t.jsx)(i.h4,{id:"7-rafra\xeechir-un-token-dacc\xe8s-optionnel",children:"7. Rafra\xeechir un token d'acc\xe8s (optionnel)"}),"\n",(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Requ\xeate"}),(0,t.jsx)("th",{children:"URL"}),(0,t.jsx)("th",{children:"Param\xe8tre"}),(0,t.jsx)("th",{children:"Valeur"})]})}),(0,t.jsxs)("tbody",{children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{rowspan:"3",children:"POST"}),(0,t.jsx)("td",{rowspan:"3",children:(0,t.jsx)(i.code,{children:"/oauth/token"})}),(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"grant_type"})}),(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"refresh_token"})})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"refresh_token"})}),(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"[REDACTED]"})})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"client_id"})}),(0,t.jsx)("td",{children:(0,t.jsx)(i.code,{children:"[REDACTED]"})})]})]})]}),"\n",(0,t.jsx)(i.h2,{id:"acc\xe8s-\xe0-lapi",children:"Acc\xe8s \xe0 l'API"}),"\n",(0,t.jsx)(i.h3,{id:"acc\xe8s-aux-informations-utilisateur-",children:"Acc\xe8s aux informations utilisateur :"}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Requ\xeate"}),(0,t.jsx)(i.th,{children:"URL"}),(0,t.jsx)(i.th,{children:"Param\xe8tre"})]})}),(0,t.jsx)(i.tbody,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:"GET"}),(0,t.jsx)(i.td,{children:(0,t.jsx)(i.code,{children:"[API_URL]/api/v1/me"})}),(0,t.jsx)(i.td,{children:"authorization: Bearer token"})]})})]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-js",metastring:'title="Exemple de retour"',children:'{\n  "user": {\n    "id": 10,\n    "firstname": "John",\n    "lastname": "Doe",\n    "email": "johndoe@localhost.com",\n    "created_at": "2024-02-13T09:00:00.389Z"\n  }\n}\n'})})]})}function h(e={}){const{wrapper:i}={...(0,r.a)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}}}]);